---
date:
  created: 2025-11-27

---

# **ğŸ“… SAISON B Semaine 4 Ã‰pisode 4 - Projet en autonomie Jour 2 - Structuration MVC et Dynamisation des Pages**

## **ğŸ“š Introduction**

DeuxiÃ¨me jour de travail sur le projet **oCoffee** ! Aujourdâ€™hui, jâ€™ai avancÃ© sur la **structuration de lâ€™architecture MVC** et la **dynamisation des pages**. Mon objectif Ã©tait de rendre les pages du site fonctionnelles de maniÃ¨re statique, puis de commencer Ã  les dynamiser avec des donnÃ©es JSON. Voici le bilan de la journÃ©e.

!!! Note DÃ©pÃ´t Github
    Le dÃ©pÃ´t Github du projet est disponible [ici](https://github.com/YoannMis/oCoffee).

<!-- more -->

---

## **Ã‰tape 1 : Structuration de lâ€™architecture MVC**

### **Contexte**

Les vues pour la **page dâ€™accueil** et le **catalogue** Ã©taient dÃ©jÃ  fournies dans le dossier dâ€™intÃ©gration du projet, avec leurs styles CSS respectifs. Mon travail a consistÃ© Ã  :

1. **CrÃ©er les vues manquantes** (page de dÃ©tails dâ€™un cafÃ© et page de prÃ©sentation de la boutique).
2. **Configurer les routes et contrÃ´leurs** pour chaque page.

**Structure du Projet :**

```bash
ğŸ“ocoffee/
â”‚
â”œâ”€â”€ ğŸ“node_modules/          # Folder generated by npm (do not version)
â”‚
â”œâ”€â”€ ğŸ“data/                            #Database folder
â”‚   â”œâ”€â”€ create-db.sql
â”‚   â””â”€â”€ coffee-sample-data.json
â”‚
â”œâ”€â”€ ğŸ“docs/                               # Project specifications folder                  
â”‚   â”œâ”€â”€ ğŸ“integration/
â”‚   â”œâ”€â”€ ğŸ“project-brief/
â”‚   â””â”€â”€ ğŸ“project-design/
â”‚
â”œâ”€â”€ ğŸ“public/                # Static files (CSS, JS, images)
â”‚   â”œâ”€â”€ ğŸ“css/               # Style sheets
â”‚   â”œâ”€â”€ ğŸ“images/            # Images for the site (logos, cafes, etc.)
â”‚   â””â”€â”€ ğŸ“js/                # Client-side JavaScript scripts
â”‚
â”œâ”€â”€ ğŸ“src/                   # Application source code
â”‚   â”œâ”€â”€ ğŸ“controllers/        # Controllers (business logic)
â”‚   â”‚   â”œâ”€â”€ home.controller.js
â”‚   â”‚   â”œâ”€â”€ catalog.controller.js
â”‚   â”‚   â””â”€â”€ coffee-datails.controller.js
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“models/             # Models (interactions with the database)
â”‚   â”‚   â”œâ”€â”€ coffee.dataMapper.js       
â”‚   â”‚   â””â”€â”€ databaseClient.js   # Connection to database    
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“routers/            # Express routes handlers
â”‚   â”‚   â”œâ”€â”€ home.router.js
â”‚   â”‚   â”œâ”€â”€ catalog.router.js
â”‚   â”‚   â”œâ”€â”€ coffee-details.router.js
â”‚   â”‚   â””â”€â”€ index.router.js
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“views/              # EJS views (templates)
â”‚       â”œâ”€â”€ ğŸ“partials/       # Reusable partials (header, footer)
â”‚       â”‚   â”œâ”€â”€ header.ejs
â”‚       â”‚   â””â”€â”€ footer.ejs
â”‚       â”œâ”€â”€ home.ejs            # Home page
â”‚       â”œâ”€â”€ catalog.ejs         # Coffee catalogue page
â”‚       â””â”€â”€ coffee-details.ejs   # Coffee details page
â”‚
â”œâ”€â”€ index.js                  # Express app entry point
â”œâ”€â”€ package.json            # Dependencies and npm scripts
â”œâ”€â”€ package-lock.json         
â”œâ”€â”€ .env                    # Environnement variables
â”œâ”€â”€ .env.example                    # Public environnement variables
â””â”€â”€ README.md               # Project documentation
```

### **Actions rÃ©alisÃ©es**

1. **CrÃ©ation des wireframes** pour les pages manquantes :
    + **Page de dÃ©tail dâ€™un cafÃ©** : Affichage des informations spÃ©cifiques (nom, origine, prix, caractÃ©ristiques, etc.).
    ![Wireframe page de dÃ©tails d'un cafÃ©](../../../../assets/sb04e04/coffee-wireframe.excalidraw.png)
2. **DÃ©veloppement des vues EJS de maniÃ¨re statique** :
    + RÃ©cupÃ©ration de la page d'intÃ©gration home.html et conversion en **`home.ejs`**.
    + RÃ©cupÃ©ration de la page d'intÃ©gration catalog.html et conversion en **`catalog.ejs`**.
    + CrÃ©ation de `coffee-details.ejs` pour la page de dÃ©tail dâ€™un cafÃ©.
    + CrÃ©ation `shop.ejs` pour la page de prÃ©sentation de la boutique.  
3. **CrÃ©ation des routes et contrÃ´leurs** :
    + `home.router.js` et `home.controller.js` pour gÃ©rer la page d'accueil.
    + `catalog.router.js` et `catalog.controller.js` pour gÃ©rer les requÃªtes liÃ©es aux cafÃ©s.
    + `shop.router.js` et `shop.controller.js` pour la page de prÃ©sentation de la boutique.
    + `index.router` pour regrouper tous les routeurs.

    **Exemple sur la Home Page :**

    === "src/views/home.ejs"

        ``` html
          <%- include('partials/header.ejs') %>

              <section id="about">
                <div>
                    <h1>Votre spÃ©cialiste Haucloquois du cafÃ©</h1>
                    <p>oCoffee est un dÃ©taillant de cafÃ© et de produits associÃ©s Ã  la consommation du cafÃ© basÃ© dans la ville de Hauts-de-Cloques. Nous importons nos produits directement des producteurs, et nous les sÃ©lectionnons selon des critÃ¨res exigeants de qualitÃ©. oCoffee est reconnu Ã  lâ€™Ã©chelle dÃ©partementale.</p>
                    <a class="button" href="#">DÃ©couvrir notre catalogue</a>
                </div>
                <img src="./images/about.jpg" alt="Selection de nos meilleurs cafÃ©s oCoffee">
              </section>

              <section id="latest-products">
                <h2>NouveautÃ©s</h2>
                
                <ul>
                  <li>
                    <article>
                      <img src="./images/coffees/100955890.png" alt="Ethiopian Yirgacheffe">
                      <div>
                        <h3>Ethiopian Yirgacheffe</h3>
                        <a class="button-outline" href="#">Voir le dÃ©tail</a>
                      </div>
                    </article>
                  </li>

                  <li>
                    <article>
                      <img src="./images/coffees/100955890.png" alt="Ethiopian Yirgacheffe">
                      <div>
                        <h3>Ethiopian Yirgacheffe</h3>
                        <a class="button-outline" href="#">Voir le dÃ©tail</a>
                      </div>
                    </article>
                  </li>

                  <li>
                    <article>
                      <img src="./images/coffees/100955890.png" alt="Ethiopian Yirgacheffe">
                      <div>
                        <h3>Ethiopian Yirgacheffe</h3>
                        <a class="button-outline" href="#">Voir le dÃ©tail</a>
                      </div>
                    </article>
                  </li>

                </ul>
              </section>

          <%- include('partials/footer.ejs') %>
        ```

    === "src/controllers/home.controller.js"

        ``` javascript
        /**
         * Controller for handling home page logic.
         * @module controllers/homeController
        */
        export default {
          /**
           * Renders the home page.
           * @function
           * @param {import('express').Request} req - Express request object
           * @param {import('express').Response} res - Express response object
          */
          displayHome: (req, res) => {
            res.render('home');
          },
        }
        ```

    === "src/routers/home.router.js"

        ``` javascript
        import { Router } from "express";
        import homeController from "../controllers/home.controller.js";

        /**
         * Router for handling home page related routes.
         * @module routers/homeRouter
        */
        const homeRouter = Router();

        /**
         * GET /
         * Route for rendering the home page.
         * Calls the displayHome method from homeController.
        */
        homeRouter.get('/', homeController.displayHome);

        export default homeRouter;
        ```
    **Router principal**

    ```javascript title="src/routers/index.router.js"
    import { Router } from 'express';
    import homeRouter from './home.router.js';

    /**
    * Main router that combines all sub-routers for the application.
    * @module routers/indexRouter
    */
    const router = Router();

    /**
    * Use the home router for home page related routes.
    */
    router.use(homeRouter);

    export default router;
    ```

4. **Mise Ã  jour du fichier `index.js` :**

    ```javascript title="index.js" hl_lines="8 15-30"
    /**
     * Main entry point for the Ocoffee application.
     * Sets up the Express server, view engine, static files, and routing.
    */

    import express from "express";
    import 'dotenv/config';
    import router from "./src/routers/index.router.js";

    // Get the port from environment variables
    const PORT = process.env.PORT;

    const app = express();

    /**
     * Set EJS as the view engine.
     * Views are located in the './src/views' directory.
    */
    app.set('view engine', 'ejs');
    app.set('views', './src/views');

    /**
     * Serve static files from the 'public' directory.
    */
    app.use(express.static('./public'));

    /**
     * Use the main router for handling all routes.
    */
    app.use(router);

    /**
     * Start the server and listen on the specified port.
     * Logs a message when the server is running.
    */
    app.listen(PORT, () => {
      console.log(`Server is running on http://localhost:${PORT}`);
    });
    ```

---

## **Ã‰tape 2 : Dynamisation des pages avec des donnÃ©es JSON**

### **Objectif**

Avant de me connecter Ã  une base de donnÃ©es PostgreSQL, jâ€™ai dÃ©cidÃ© de **simuler une base de donnÃ©es** avec un fichier JSON contenant un Ã©chantillon de donnÃ©es sur les cafÃ©s. Cela me permet de tester le rendu dynamique des pages sans dÃ©pendre dâ€™une base de donnÃ©es.

### **Actions rÃ©alisÃ©es**

1. **CrÃ©ation du fichier `data/coffee-sample-data.json`** :

    ```json title="data/coffee-sample-data.json"
    [
      {
        "reference": "100955890",
        "name": "Espresso",
        "description": "CafÃ© fort et concentrÃ©...",
        "origin": "Italie",
        "image": "100955890.png",
        "price": 20.99,
        "available": true,
        "coffee_attributes": ["CorsÃ©", "Ã‰picÃ©"]
      },
      // ... (other coffees)
    ]
    ```

2. **IntÃ©gration des donnÃ©es JSON dans les contrÃ´leurs** :

    **Exemple sur la Home Page :**

    ```javascript title="src/controller/home.controller.js"
    import coffees from '../../data/coffee-sample-data.json' with { type: 'json' };

    /**
     * Controller for handling home page logic.
      * @module controllers/homeController
    */
    export default {
      /**
       * Renders the home page with the three latest coffees.
        * Sorts the coffee data by reference in descending order and selects the top three.
        *
        * @function
        * @param {import('express').Request} req - Express request object
        * @param {import('express').Response} res - Express response object
        * @returns {void}
      */
      displayHome: (req, res) => {
        // Sort the coffees array by reference in descending order
        const sortedCoffees = coffees.toSorted((a, b) => b.reference - a.reference);

        // Select the three latest coffees
        const threeLatestCoffees = sortedCoffees.slice(0, 3);

        // Render the 'home' view, passing the three latest coffees to the template
        res.render('home', { coffees: threeLatestCoffees });
      },
    };
    ```

3. **Affichage dynamique dans les vues EJS** :

    ```html title="src/views/home.ejs" hl_lines="15-28"
    <%- include('partials/header.ejs') %>

      <section id="about">
        <div>
            <h1>Votre spÃ©cialiste Haucloquois du cafÃ©</h1>
            <p>oCoffee est un dÃ©taillant de cafÃ© et de produits associÃ©s Ã  la consommation du cafÃ© basÃ© dans la ville de Hauts-de-Cloques. Nous importons nos produits directement des producteurs, et nous les sÃ©lectionnons selon des critÃ¨res exigeants de qualitÃ©. oCoffee est reconnu Ã  lâ€™Ã©chelle dÃ©partementale.</p>
            <a class="button" href="/Catalogue">DÃ©couvrir notre catalogue</a>
        </div>
        <img src="./images/about.jpg" alt="Selection de nos meilleurs cafÃ©s oCoffee">
      </section>

      <section id="latest-products">
        <h2>NouveautÃ©s</h2>
        
        <ul>
          <!-- Replace hard coding by a for...of loop with data from home.controller context -->
          <% for( const coffee of coffees ) { %>
            <li>
              <article>
                <img src="./images/coffees/<%= coffee.image %>" alt="<%= `image de cafÃ© ${coffee.name}` %>">
                <div>
                  <h3><%= coffee.name %></h3>
                  <a class="button-outline" href="/Catalogue/Cafe/<%= coffee.reference %>">Voir le dÃ©tail</a>
                </div>
              </article>
            </li>
          <% } %>
        </ul>
      </section>

    <%- include('partials/footer.ejs') %>

    ```

Voir le code complet sur [mon dÃ©pÃ´t Github](https://github.com/YoannMis/oCoffee).

---

## **Ã‰tape 3 : RÃ©solution dâ€™un bug dâ€™affichage**

### **ProblÃ¨me rencontrÃ©**

En testant la page de dÃ©tail dâ€™un cafÃ©, jâ€™ai rencontrÃ© une erreur dans la console :

```bash
Refused to apply style from '<URL>' because its MIME type ('text/html') is not a supported stylesheet MIME type, and strict MIME checking is enabled.
```

### **Diagnostic**

Cette erreur indiquait que le navigateur refusait dâ€™appliquer le fichier CSS car il ne le reconnaissait pas comme une feuille de style. AprÃ¨s investigation, jâ€™ai rÃ©alisÃ© que le problÃ¨me venait des **chemins des fichiers statiques** dans ma vue EJS.

### **Solution**

Dans le fichier dâ€™intÃ©gration HTML fourni, les chemins vers les fichiers CSS Ã©taient sous la forme `../css/style.css`. Or, avec EJS et Express, les fichiers statiques doivent Ãªtre rÃ©fÃ©rencÃ©s depuis le dossier `public/` avec un chemin absolu :

=== "Chemin des liens css avant"

    ``` html title="src/views/coffee-details.ejs"
    <link rel="stylesheet" href="../css/style.css">
    ```

=== "Chemin des liens css aprÃ¨s"

    ``` html title="src/views/coffee-details.ejs"
    <link rel="stylesheet" href="/css/style.css">
    ```

Une fois cette petite correction effectuÃ©e, le style sâ€™est appliquÃ© correctement.  
J'ai modifiÃ© toutes les vues ejs en faisant attention aux chemins des fichiers statiques.

---

## **Bilan de la journÃ©e**

### **Ce qui a bien fonctionnÃ©**

âœ… **Structuration MVC** : Les routes, contrÃ´leurs et vues sont maintenant bien organisÃ©s.  
âœ… **Dynamisation des pages** : Les donnÃ©es JSON sont correctement intÃ©grÃ©es et affichÃ©es.  
âœ… **RÃ©solution du bug** : Jâ€™ai compris lâ€™importance des chemins des fichiers statiques dans un projet Express.

### **DifficultÃ©s rencontrÃ©es**

âš ï¸ **Chemins des fichiers statiques** : Une erreur simple mais qui mâ€™a fait perdre du temps.

### **Objectifs pour demain**

ğŸ”¹ **CrÃ©ation de la base de donnÃ©es PostgreSQL** :

+ ImplÃ©menter le MPD crÃ©Ã© hier.
+ Connecter lâ€™application Express Ã  la base de donnÃ©es.

ğŸ”¹ **Remplacer les donnÃ©es JSON par des requÃªtes SQL** :

+ Utiliser `pg` pour interagir avec PostgreSQL.
+ Mettre Ã  jour les contrÃ´leurs pour rÃ©cupÃ©rer les donnÃ©es depuis la base de donnÃ©es.

---

## **Conclusion**

Cette deuxiÃ¨me journÃ©e a Ã©tÃ© **intense mais trÃ¨s formatrice**. Jâ€™ai pu appliquer les concepts MVC, dynamiser mes pages et rÃ©soudre des problÃ¨mes techniques. Demain, je passe Ã  lâ€™Ã©tape cruciale de la crÃ©ation et connection Ã  la **base de donnÃ©es** !
