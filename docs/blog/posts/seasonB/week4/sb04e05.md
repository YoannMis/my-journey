---
date:
  created: 2025-11-28

draft: true
---

# **ğŸ“… SAISON B Semaine 4 Ã‰pisode 5 - Projet en autonomie Jour 3 - Base de DonnÃ©es, Gestion des Erreurs et Style**

## **ğŸ“š Introduction**

TroisiÃ¨me jour de travail sur le projet **oCoffee** ! Aujourdâ€™hui, jâ€™ai franchi une Ã©tape majeure en **crÃ©ant et connectant la base de donnÃ©es PostgreSQL**, en **dynamisant entiÃ¨rement les pages** avec les donnÃ©es de la base, et en **amÃ©liorant lâ€™expÃ©rience utilisateur** avec une page 404 personnalisÃ©e et un design responsive. Voici le dÃ©tail de cette journÃ©e bien remplie.

<!-- more -->

---

## **Ã‰tape 1 : CrÃ©ation de la Base de DonnÃ©es PostgreSQL**

### **Contexte**

Hier, jâ€™avais prÃ©parÃ© un fichier JSON pour simuler une base de donnÃ©es. Aujourdâ€™hui, jâ€™ai **crÃ©Ã© la base de donnÃ©es PostgreSQL** pour stocker les donnÃ©es de maniÃ¨re permanente.

### **Actions rÃ©alisÃ©es**

1. **CrÃ©ation du script SQL** (`data/create_db.sql`) :
   Ce script contient les requÃªtes pour crÃ©er les tables `COUNTRIES`, `COFFEE_ATTRIBUTES`, `COFFEES`, et `COFFEES_HAS_COUNTRIES`, basÃ©es sur le MPD que jâ€™avais conÃ§u prÃ©cÃ©demment.

   ```sql
   -- Exemple de crÃ©ation de table
   CREATE TABLE COUNTRIES (
       country_id SERIAL PRIMARY KEY,
       name VARCHAR(100) NOT NULL
   );

   CREATE TABLE COFFEES (
       coffee_ref SERIAL PRIMARY KEY,
       coffee_name VARCHAR(100) NOT NULL,
       image VARCHAR(255),
       price DECIMAL(6, 2) NOT NULL,
       availability BOOLEAN DEFAULT TRUE,
       attribute_id INT REFERENCES COFFEE_ATTRIBUTES(attribute_id),
       country_id INT REFERENCES COUNTRIES(country_id)
   );
   ```

2. **ExÃ©cution du script** :

   + Jâ€™ai crÃ©Ã© la base de donnÃ©es `oCoffee` dans `psql` :

     ```bash
     createdb oCoffee
     ```

   + Puis jâ€™ai exÃ©cutÃ© le script SQL pour crÃ©er les tables :

     ```bash
     psql -d oCoffee -f data/create_db.sql
     ```

---

## **Ã‰tape 2 : Connexion Ã  la Base de DonnÃ©es et RÃ©cupÃ©ration des DonnÃ©es**

### **Contexte**

Jâ€™ai remplacÃ© la logique de rÃ©cupÃ©ration des donnÃ©es depuis le fichier JSON par des **requÃªtes SQL** pour interagir avec la base de donnÃ©es PostgreSQL.

### **Actions rÃ©alisÃ©es**

1. **Configuration de la connexion Ã  la base de donnÃ©es** (`src/models/databaseClient.js`) :
   Jâ€™ai utilisÃ© le module `pg` pour Ã©tablir une connexion sÃ©curisÃ©e Ã  la base de donnÃ©es.

   ```javascript
   // src/models/databaseClient.js
   const { Pool } = require('pg');
   require('dotenv').config();

   const pool = new Pool({
     connectionString: process.env.DB_URL,
   });

   module.exports = pool;
   ```

2. **CrÃ©ation dâ€™un DataMapper** (`src/models/coffee.dataMapper.js`) :
   Ce fichier contient les fonctions pour interagir avec la table `COFFEES`.

   ```javascript
   // src/models/coffee.dataMapper.js
   const pool = require('./databaseClient');

   class CoffeeDataMapper {
     static async getAll() {
       const { rows } = await pool.query('SELECT * FROM COFFEES');
       return rows;
     }

     static async getByReference(reference) {
       const { rows } = await pool.query('SELECT * FROM COFFEES WHERE coffee_ref = $1', [reference]);
       return rows[0];
     }
   }

   module.exports = CoffeeDataMapper;
   ```

3. **Modification des contrÃ´leurs** :
   Jâ€™ai mis Ã  jour les contrÃ´leurs pour utiliser le `CoffeeDataMapper` au lieu du fichier JSON.

   ```javascript
   // src/controllers/catalog.controller.js
   const CoffeeDataMapper = require('../models/coffee.dataMapper');

   exports.getAllCoffees = async (req, res, next) => {
     try {
       const coffees = await CoffeeDataMapper.getAll();
       res.render('catalog', { coffees });
     } catch (error) {
       next(error);
     }
   };
   ```

---

## **Ã‰tape 3 : Gestion des Erreurs 404 et 500**

### **Contexte**

Pour amÃ©liorer lâ€™expÃ©rience utilisateur, jâ€™ai ajoutÃ© une **page 404 personnalisÃ©e** et une gestion des erreurs 500.

### **Actions rÃ©alisÃ©es**

1. **CrÃ©ation dâ€™une vue pour la page 404** (`views/404.ejs`) :

   Une page ludique avec une illustration de tasse de cafÃ© renversÃ©e et des liens utiles.

   ```html
   <!-- views/404.ejs -->
   <h1>Oups, cette page sâ€™est Ã©chappÃ©e comme une goutte de cafÃ© !</h1>
   <p>La page que vous cherchez nâ€™existe pas ou a Ã©tÃ© dÃ©placÃ©e.</p>
   <a href="/" class="btn">Retour Ã  lâ€™accueil</a>
   <a href="/coffees" class="btn">DÃ©couvrir notre catalogue</a>
   ```

2. **Gestion des erreurs 500** :

   Jâ€™ai crÃ©Ã© une vue `views/500.ejs` et ajoutÃ© un middleware pour capturer les erreurs.

   ```javascript
   // Dans app.js
   app.use((err, req, res, next) => {
     console.error(err.stack);
     res.status(500).render('500');
   });
   ```

3. **Ajout de `try...catch` dans les contrÃ´leurs** :

   Pour gÃ©rer les erreurs de maniÃ¨re Ã©lÃ©gante.

   ```javascript
   exports.getCoffeeByReference = async (req, res, next) => {
     try {
       const coffee = await CoffeeDataMapper.getByReference(req.params.reference);
       if (!coffee) {
         return res.status(404).render('404');
       }
       res.render('coffee-details', { coffee });
     } catch (error) {
       next(error);
     }
   };
   ```

---

## **Ã‰tape 4 : Stylisation des Pages et Responsive Design**

### **Contexte**

Jâ€™ai travaillÃ© sur le **style CSS** des nouvelles vues (`coffee-details.ejs` et `shop.ejs`) et rendu lâ€™application **responsive** pour les appareils mobiles.

### **Actions rÃ©alisÃ©es**

1. **CrÃ©ation de fichiers CSS dÃ©diÃ©s** :

   + `public/css/coffee-details.css` pour la page de dÃ©tail dâ€™un cafÃ©.
   + `public/css/shop.css` pour la page de prÃ©sentation de la boutique.

2. **Responsive Design** :
   Jâ€™ai utilisÃ© des **media q
   eries** pour adapter lâ€™affichage sur mobile.

   ```css
   /* Exemple de media query */
   @media (max-width: 768px) {
     .coffee-container {
       flex-direction: column;
     }
     .coffee-image, .coffee-info {
       width: 100%;
     }
   }
   ```

---

## **Bilan de la JournÃ©e**

### **Ce qui a bien fonctionnÃ©**

âœ… **Base de donnÃ©es PostgreSQL** : CrÃ©Ã©e et connectÃ©e avec succÃ¨s.
âœ… **Dynamisation des pages** : Les donnÃ©es sont maintenant rÃ©cupÃ©rÃ©es depuis la base.
âœ… **Gestion des erreurs** : Pages 404 et 500 personnalisÃ©es et fonctionnelles.
âœ… **Responsive Design** : Lâ€™application sâ€™affiche correctement sur mobile.

### **DifficultÃ©s rencontrÃ©es**

âš  **Chemins des fichiers statiques** : Jâ€™ai dÃ» corriger les chemins pour Ã©viter les erreurs de chargement des CSS.
âš  **Gestion des erreurs asynchrones** : Lâ€™utilisation de `try...catch` avec des fonctions asynchrones a nÃ©cessitÃ© une attention particuliÃ¨re.

### **Structure finale du projet**

Voici lâ€™arborescence finale de mon projet :

```bash
ocoffee/
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ create_db.sql
â”‚   â””â”€â”€ coffee-sample-data.json
â”‚
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ js/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ routers/
â”‚   â””â”€â”€ views/
â”‚
â”œâ”€â”€ index.js
â”œâ”€â”€ package.json
â”œâ”€â”€ .env
â””â”€â”€ README.md
```

---

## **Prochaines Ã‰tapes et FonctionnalitÃ©s Futures**

Pour aller plus loin, jâ€™aimerais ajouter :

+ **Une carte interactive** dans la page `shop.ejs` pour indiquer lâ€™emplacement de la boutique (avec Leaflet et OpenStreetMap).
+ **Un formulaire de contact** qui envoie un email de confirmation (avec EmailJS).
+ **Une page dâ€™administration** pour ajouter de nouveaux cafÃ©s (avec Multer pour la gestion des images).
+ **DÃ©ployer lâ€™application** sur un PaaS comme Render.

---

## **Conclusion**

Cette troisiÃ¨me journÃ©e a Ã©tÃ© **trÃ¨s enrichissante** ! Jâ€™ai appris Ã  :

+ CrÃ©er et connecter une base de donnÃ©es PostgreSQL.
+ GÃ©rer les erreurs de maniÃ¨re Ã©lÃ©gante.
+ Rendre mon application responsive.

Demain, je vais me concentrer sur lâ€™**amÃ©lioration des fonctionnalitÃ©s** et peut-Ãªtre commencer Ã  explorer le dÃ©ploiement.
