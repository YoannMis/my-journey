---
date:
  created: 2025-11-12

draft: true
---

# **ğŸ“… SAISON B Semaine 2 Ã‰pisode 1 - Atelier Pair-Programming â€“ CrÃ©ation dâ€™un Site pour le Studio Ghibli avec Express et EJS !**

## **ğŸ“š Notions du jour**

Aujourdâ€™hui, en **pair-programming**, nous avons crÃ©Ã© un **site web dÃ©diÃ© aux films du studio Ghibli** en utilisant **Node.js, Express et EJS**. Lâ€™objectif Ã©tait de mettre en pratique tout ce que nous avons appris sur les **routes, les templates dynamiques et les fichiers statiques**, en suivant des Ã©tapes guidÃ©es.

**FonctionnalitÃ©s Ã  rÃ©aliser :**

1. **Page dâ€™accueil** : Afficher 3 films sÃ©lectionnÃ©s.
2. **Page de liste des films** : Afficher tous les films du studio.
3. **Page dÃ©taillÃ©e dâ€™un film** : Afficher les dÃ©tails dâ€™un film spÃ©cifique via une **route paramÃ©trÃ©e**.
4. **Gestion des erreurs** : Afficher une page 404 si un film nâ€™est pas trouvÃ©.
5. **Factorisation avec des *partials*** : RÃ©utiliser des Ã©lÃ©ments communs (header, footer) dans toutes les pages.
6. **Bonus** : Ajouter des fonctionnalitÃ©s supplÃ©mentaires (affichage du nombre total de films, formatage de la durÃ©e, etc.).

<!-- more -->

---

### **ğŸ“ Structure initiale du projet rÃ©cupÃ©rÃ©**

```bash
ğŸ“ ghibliothÃ¨que/              # Root Folder
â”œâ”€â”€ ğŸ“ assets/                   # Assets files Folder
â”‚   â”œâ”€â”€ ğŸ“ css/                  # CSS files Folder
â”‚   â”‚   â””â”€â”€ style.css              # Main styles CSS file
â”‚   â”œâ”€â”€ ğŸ“ img/                  # Images Folder
â”‚   â”œâ”€â”€ ğŸ“ html/                 # HTML files Folder
â”‚   â”‚   â”œâ”€â”€ movies.html            # Full list of movies page
â”‚   â”‚   â”œâ”€â”€ home.html              # Home page
â”‚   â”‚   â”œâ”€â”€ movie.html             # Details movie page
â”‚   â”‚   â””â”€â”€ 404.html               # Error 404 page
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ ğŸ“ data/                     # Data Folder
â”‚   â””â”€â”€ movies.js                # Movies data (given)
â””â”€â”€ README.md
```

### **ğŸš€ Ã‰tape 1 : Mise en Place du Serveur Express**

**Objectif :** Initialiser un projet Node.js, installer Express, et configurer un serveur basique.

1. **Initialisation d'un projet Node.js.**
  Pour cela on commence par initialiser un projet Node.js avec la commande `npn init -y` dans le dossier *racine* de notre projet.  
  Cela va crÃ©er les fchiers de configuration de notre projet : `package.json` et `package-lock.json`.

2. **Modification du fichier `package.json`.**
  On modifie le fichier package.json afin d'avoir un projet organisÃ© en modules et pouvoir lancer des scripts prÃ©-dÃ©finis pour lancer le serveur rapidement :

  ```json title="package.json"
  {
    "scripts": {
      "start": "node index.js",
      "dev": "node --watch index.js"
    },
    "type": "module"
  }
  ```

3. **Installation des dÃ©pendances Express et EJS nÃ©cessaires Ã  notre projet.**
  On install Express avec la commande `npm install express` et EJS avec `npm install ejs`.

  **ğŸ‘¨â€ğŸ’» Notre code :**

  *CrÃ©ation d'un fichier `index.js` pour crÃ©er et lancer un serveur et vÃ©rifier que l'installation s'est bien passÃ©e.*

  ```javascript title="index.js"
  import express from 'express';

  const app = express();
  const port = 3000;

  // Testing route
  app.get('/', (req, res) => {
    res.send("Home");
  });

  // Start the server
  app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
  });
  ```

---

### **ğŸ“ Ã‰tape 2 : Configuration des Fichiers Statiques**

**Objectif :** Servir les fichiers CSS et images depuis le dossier `public/`.

Modification du nom du dossier `assets/` en `public/`.

**ğŸ“ Nouvelle structure du Projet :**

```bash
ğŸ“ ghibliothÃ¨que/              # Root Folder
â”œâ”€â”€ ğŸ“ public/                   # Public files Folder
â”‚   â”œâ”€â”€ ğŸ“ css/                  # CSS files Folder
â”‚   â”‚   â””â”€â”€ style.css              # Main styles CSS file
â”‚   â”œâ”€â”€ ğŸ“ img/                  # Images Folder
â”‚   â”œâ”€â”€ ğŸ“ html/                 # HTML files Folder
â”‚   â”‚   â”œâ”€â”€ movies.html            # Full list of movies page
â”‚   â”‚   â”œâ”€â”€ home.html              # Home page
â”‚   â”‚   â”œâ”€â”€ movie.html             # Details movie page
â”‚   â”‚   â””â”€â”€ 404.html               # Error 404 page
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ ğŸ“ data/                     # Data Folder
â”‚   â””â”€â”€ movies.js                # Movies data (given)
â”œâ”€â”€ index.js                     # Express server entry point
â””â”€â”€ README.md
```

**ğŸ‘¨â€ğŸ’» Notre code :**

```javascript title="index.js - ajout lien vers fichiers statiques" hl_lines="10 11"
import express from 'express';

const app = express();
const port = 3000;

app.get('/', (req, res) => {
  res.send("Home");
});

// Serving static files
app.use(express.static("public"));

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

AccÃ©der Ã  `http://localhost:3000/css/style.css` pour vÃ©rifier que le fichier CSS est bien servi.

---

### **âš™ï¸ Ã‰tape 3 : Configuration dâ€™EJS et du Dossier `views`**

**Objectif :** Configurer Express pour utiliser EJS et rendre les templates dynamiques.

1. **Renommage des fichiers HTML en `.ejs` :**
  Les fichiers fournis (`home.html`, `movies.html`, etc.) sont renommÃ©s en `.ejs` et placÃ©s dans le dossier `views/`.

2. **Modification de l'Architecture de notre Projet**
  CrÃ©ation d'un dossier **`src\`** oÃ¹ l'on va ranger nos fichiers selon une **Acrhitecture MVC**.

  **ğŸ“ Nouvelle structure du Projet :**

  ```bash hl_lines="8-17"
  ğŸ“ ghibliothÃ¨que/              # Root Folder
  â”œâ”€â”€ ğŸ“ node_modules/             # Node modules Folder
  â”œâ”€â”€ ğŸ“ public/                   # Static files Folder
  â”‚   â”œâ”€â”€ ğŸ“ css/                  # CSS files Folder
  â”‚   â”‚   â””â”€â”€ style.css              # Main styles CSS file
  â”‚   â”œâ”€â”€ ğŸ“ img/                  # Images Folder
  â”‚   â””â”€â”€ favicon.ico
  â”œâ”€â”€ ğŸ“ src/                      # Code layout Folder
  â”‚   â”œâ”€â”€ ğŸ“ controllers/            # Controllers Folder
  â”‚   â”‚   â””â”€â”€ controller.js
  â”‚   â”œâ”€â”€ ğŸ“ routers/                # Routers Folder
  â”‚   â”‚   â””â”€â”€ index.router.js
  â”‚   â””â”€â”€ ğŸ“ views/                  # Views Folder
  â”‚       â”œâ”€â”€ movies.ejs               # Full list of movies page
  â”‚       â”œâ”€â”€ home.ejs                 # Home page
  â”‚       â”œâ”€â”€ movie.ejs                # Details movie page
  â”‚       â””â”€â”€ 404.ejs                  # Error 404 page
  â”œâ”€â”€ ğŸ“ data/                     # Data Folder
  â”‚   â””â”€â”€ movies.js                # Movies data (given)
  â”œâ”€â”€ package.json
  â”œâ”€â”€ package-lock.json
  â”œâ”€â”€ index.js                     # Express server entry point
  â””â”€â”€ README.md
  ```

3. **Modification du fichier `index.js`**

  **ğŸ‘¨â€ğŸ’» Notre code :**

  ```javascript title="index.js - ajout lien vers fichiers statiques" hl_lines="10-12"
  import express from 'express';

  const app = express();
  const port = 3000;

  app.get('/', (req, res) => {
    res.send("Home");
  });

  // Configure EJS
  app.set('view engine', 'ejs');
  app.set('views', './src/views');

  app.use(express.static("public"));

  app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
  });
  ```

---

### **ğŸ“Š Ã‰tape 4 : IntÃ©gration des DonnÃ©es des Films**

**Objectif :** Importer les donnÃ©es des films depuis `data/movies.js`.

**ğŸ‘¨â€ğŸ’» Notre code :**

On importe les donnÃ©es dans notre controller.

```javascript title="src/controllers/controller.js" hl_lines="1"
import movies from '../../data/movies.js';

// Controller 1

// Controller 2

// ...
```

---

### **ğŸ  Ã‰tape 5 : AmÃ©lioration de la Page dâ€™Accueil**

**Objectif :** Afficher **3 films** sur la page dâ€™accueil en utilisant les donnÃ©es importÃ©es.

**ğŸ‘¨â€ğŸ’» Notre code :**

Le **Controller** gÃ¨re la requÃªte et indique le *template* `home.ejs` Ã  utiliser pour le *rendu* de la page.

```javascript title="/src/controllers/controller.js" linenums="1" hl_lines="3-7"
import movies from "../../data/movies.js";

export function displayMovies(req, res) {
    res.render("home", {
        movies: movies
    });
};
```

Le **Router** dÃ©finit la route `/` et le ***controller*** `controller.js` qui sera utilisÃ© pour le rendu de la page.

```javascript title="/src/routers/index.router.js" linenums="1" hl_lines="6-7"
import { Router } from "express";
import { displayMovies } from "../controllers/controller.js";

const router = Router();

router.get("/", displayMovies);

export default router;

```

Le fichier principal `index.js` appel le ***Router*** pour la gestion des routes.

```javascript title="index.js" linenums="1" hl_lines="2 12"
import express from 'express';
import router from './src/routers/index.router.js'

const app = express();
const port = 3000;

app.use(express.static("public"));

app.set('view engine', 'ejs');
app.set('views', './src/views');

app.use(router);

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

**Template `home.ejs` utilisÃ© :**

```html
<!-- views/home.ejs -->
<%- include('partials/header', { title: "Accueil - GhibliothÃ¨que" }) %>

<main>
  <h1>Films Ã  l'affiche</h1>
  <div class="movies">
    <% movies.forEach(movie => { %>
      <article>
        <img src="/img/<%= movie.image %>" alt="<%= movie.title %>">
        <h2><%= movie.title %></h2>
        <p><%= movie.description.substring(0, 100) %>...</p>
        <a href="/movies/<%= movie.id %>">Voir plus</a>
      </article>
    <% }); %>
  </div>
</main>

<%- include('partials/footer') %>
```

---

### **ğŸï¸ Ã‰tape 6 : CrÃ©ation de la Page Liste des Films (`/movies`)**

**Objectif :** Afficher **tous les films** dans une page dÃ©diÃ©e.

**Notre code :**
*(InsÃ©rer ici le bloc de code pour la route `/movies` et le template `movies.ejs`. Par exemple :)*

```javascript
// index.js
app.get('/movies', (req, res) => {
  res.render('movies', { movies });
});
```

**Template `movies.ejs` :**

```html
<!-- views/movies.ejs -->
<%- include('partials/header', { title: "Tous les films - GhibliothÃ¨que" }) %>

<main>
  <h1>Tous les films (<%= movies.length %>)</h1>
  <div class="movies">
    <% movies.forEach(movie => { %>
      <article>
        <img src="/img/<%= movie.image %>" alt="<%= movie.title %>">
        <h2><%= movie.title %> (<%= movie.year %>)</h2>
        <p><%= movie.description %></p>
        <a href="/movies/<%= movie.id %>">Voir plus</a>
      </article>
    <% }); %>
  </div>
</main>

<%- include('partials/footer') %>
```

---

### **ğŸ” Ã‰tape 7 : Route ParamÃ©trÃ©e pour les DÃ©tails dâ€™un Film (`/movies/:id`)**

**Objectif :** Afficher les dÃ©tails dâ€™un film spÃ©cifique en fonction de son ID.

**Notre code :**
*(InsÃ©rer ici le bloc de code pour la route `/movies/:id` et le template `movie.ejs`. Par exemple :)*

```javascript
// index.js
app.get('/movies/:id', (req, res) => {
  const movieId = parseInt(req.params.id);
  const movie = movies.find(m => m.id === movieId);

  if (!movie) {
    return res.status(404).render('404', { message: "Film non trouvÃ©" });
  }

  res.render('movie', { movie });
});
```

**Template `movie.ejs` :**

```html
<!-- views/movie.ejs -->
<%- include('partials/header', { title: `${movie.title} - GhibliothÃ¨que` }) %>

<main>
  <article>
    <img src="/img/<%= movie.image %>" alt="<%= movie.title %>">
    <h1><%= movie.title %> (<%= movie.year %>)</h1>
    <p><%= movie.description %></p>
    <p>DurÃ©e : <%= Math.floor(movie.duration / 60) %>h<%= movie.duration % 60 %>min</p>
    <% if (movie.year > 2010) { %>
      <span>ğŸ†•</span>
    <% } %>
  </article>
  <a href="/movies">Retour Ã  la liste</a>
</main>

<%- include('partials/footer') %>
```

**DifficultÃ©s rencontrÃ©es :**

- **Conversion de lâ€™ID en nombre** : Nous avons oubliÃ© de convertir `req.params.id` en nombre (`parseInt`), ce qui a causÃ© des erreurs de comparaison. **Solution** : Toujours vÃ©rifier les types des paramÃ¨tres dâ€™URL !

---

### **âš™ï¸ Ã‰tape 8 : Gestion des Erreurs 404**

**Objectif :** Afficher une page 404 personnalisÃ©e si un film nâ€™est pas trouvÃ© ou si lâ€™URL est invalide.

**Notre code :**
*(InsÃ©rer ici le bloc de code pour la gestion des erreurs 404 et le template `404.ejs`. Par exemple :)*

```javascript
// index.js
// Middleware pour les routes non trouvÃ©es
app.use((req, res) => {
  res.status(404).render('404', { message: "Page non trouvÃ©e" });
});
```

**Template `404.ejs` :**

```html
<!-- views/404.ejs -->
<%- include('partials/header', { title: "404 - GhibliothÃ¨que" }) %>

<main>
  <h1>âš ï¸ <%= message %></h1>
  <p>La page que vous cherchez n'existe pas.</p>
  <a href="/">Retour Ã  l'accueil</a>
</main>

<%- include('partials/footer') %>
```

---

### **ğŸ§© Ã‰tape 9 : Factorisation avec des *Partials***

**Objectif :** RÃ©utiliser des Ã©lÃ©ments communs (header, footer) dans tous les templates.

**Notre code :**
*(InsÃ©rer ici le bloc de code pour les *partials* `header.ejs` et `footer.ejs`. Par exemple :)*

**`partials/header.ejs` :**

```html
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <h1>GhibliothÃ¨que ğŸ¯</h1>
    <nav>
      <a href="/">Accueil</a>
      <a href="/movies">Films (<%= movies ? movies.length : '?' %>)</a>
    </nav>
  </header>
```

**`partials/footer.ejs` :**

```html
<footer>
  <p>Â© 2025 GhibliothÃ¨que â€“ Tous droits rÃ©servÃ©s</p>
</footer>
</body>
</html>
```

**Utilisation dans les templates :**

```html
<%- include('partials/header', { title: "Mon titre", movies: movies }) %>
```

**DifficultÃ©s rencontrÃ©es :**

- **Passage des donnÃ©es aux *partials*** : Nous avons dâ€™abord oubliÃ© de passer le tableau `movies` au header pour afficher le nombre total de films. **Solution** : Toujours vÃ©rifier que les donnÃ©es nÃ©cessaires sont transmises aux *partials*.

---

### **ğŸ§© Bonus : FonctionnalitÃ©s SupplÃ©mentaires**

Nous avons implÃ©mentÃ© quelques **bonus** pour amÃ©liorer lâ€™expÃ©rience utilisateur :

1. **Afficher le nombre total de films** dans la barre de navigation :

   ```html
   <!-- Dans partials/header.ejs -->
   <a href="/movies">Films (<%= movies.length %>)</a>
   ```

2. **Formater la durÃ©e des films** en `H:mm` :

   ```html
   <!-- Dans movie.ejs -->
   <p>DurÃ©e : <%= Math.floor(movie.duration / 60) %>h<%= movie.duration % 60 %>min</p>
   ```

3. **Ajouter un badge "ğŸ†•" pour les films rÃ©cents** (aprÃ¨s 2010) :
   ```html
   <!-- Dans movie.ejs -->
   <% if (movie.year > 2010) { %>
     <span>ğŸ†•</span>
   <% } %>
   ```

4. **Tronquer les descriptions** sur la page dâ€™accueil :

   ```javascript
   // Dans home.ejs
   <p><%= movie.description.substring(0, 60) %>...</p>
   ```

5. **Factoriser la structure des `<article>`** :

   Nous avons crÃ©Ã© un *partial* `movie-card.ejs` pour rÃ©utiliser la structure des cartes de films :

   ```html
   <!-- views/partials/movie-card.ejs -->
   <article>
     <img src="/img/<%= movie.image %>" alt="<%= movie.title %>">
     <h2><%= movie.title %></h2>
     <p><%= description %></p>
     <a href="/movies/<%= movie.id %>">Voir plus</a>
   </article>
   ```

   **Utilisation dans `home.ejs` et `movies.ejs` :**

   ```html
   <%- include('partials/movie-card', {
     movie: movie,
     description: movie.description.substring(0, 60) + "..."
   }) %>
   ```

---

### **ğŸ–¥ï¸ Rendu Final du Site**

*(InsÃ©rer ici des captures dâ€™Ã©cran des diffÃ©rentes pages du site :)*

1. **Page dâ€™accueil (`/`)** :
   *(Capture dâ€™Ã©cran avec 3 films mis en avant.)*

2. **Page liste des films (`/movies`)** :
   *(Capture dâ€™Ã©cran avec tous les films et le nombre total affichÃ© dans la barre de navigation.)*

3. **Page dÃ©taillÃ©e dâ€™un film (`/movies/1`)** :
   *(Capture dâ€™Ã©cran avec les dÃ©tails du film, la durÃ©e formatÃ©e et le badge "ğŸ†•" si applicable.)*

4. **Page 404** :
   *(Capture dâ€™Ã©cran de la page dâ€™erreur personnalisÃ©e.)*

---

### **ğŸ’¡ Ce Que Jâ€™ai Appris en Pair-Programming**

1. **La communication est clÃ©** : Discuter des idÃ©es avant de coder Ã©vite les incomprÃ©hensions.
2. **Diviser les tÃ¢ches** : Lâ€™un sâ€™occupait des routes, lâ€™autre des templates, puis on Ã©changeait les rÃ´les.
3. **DÃ©boguer ensemble** : Deux paires dâ€™yeux voient plus de bugs quâ€™une seule !
4. **Les *partials* sauvent du temps** : Factoriser le code HTML Ã©vite les rÃ©pÃ©titions et les erreurs.
5. **Toujours prÃ©voir les cas dâ€™erreur** : Une route 404 bien conÃ§ue amÃ©liore lâ€™expÃ©rience utilisateur.

---

### **ğŸ“ Structure du Projet**

Voici lâ€™**arbre des dossiers** du projet final :

```bash
ğŸ“ ghibliothÃ¨que/              # Root Folder
â”œâ”€â”€ ğŸ“ node_modules/             # Node modules Folder
â”œâ”€â”€ ğŸ“ public/                   # Static files Folder
â”‚   â”œâ”€â”€ ğŸ“ css/                  # CSS files Folder
â”‚   â”‚   â””â”€â”€ style.css              # Main styles CSS file
â”‚   â”œâ”€â”€ ğŸ“ img/                  # Images Folder
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ ğŸ“ src/                      # Code layout Folder
â”‚   â”œâ”€â”€ ğŸ“ controllers/            # Controllers Folder
â”‚   â”‚   â””â”€â”€ controller.js
â”‚   â”œâ”€â”€ ğŸ“ routers/                # Routers Folder
â”‚   â”‚   â””â”€â”€ index.router.js
â”‚   â””â”€â”€ ğŸ“ views/                  # Views Folder
â”‚       â”œâ”€â”€ movies.ejs               # Full list of movies page
â”‚       â”œâ”€â”€ home.ejs                 # Home page
â”‚       â”œâ”€â”€ movie.ejs                # Details movie page
â”‚       â”œâ”€â”€ 404.ejs                  # Error 404 page
â”‚       â””â”€â”€ ğŸ“ partials/             # Partials Folder
â”‚           â”œâ”€â”€ header.ejs             # Partial for header
â”‚           â””â”€â”€ footer.ejs             # Partial for footer
â”œâ”€â”€ ğŸ“ data/                     # Data Folder
â”‚   â””â”€â”€ movies.js                # Movies data (given)
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ index.js                     # Express server entry point
â””â”€â”€ README.md
```
