---
date:
  created: 2025-11-13
  updated: 2025-11-14

draft: true
---

# **ğŸ“… SAISON B Semaine 2 Ã‰pisode 2 - Architecture MVC et Variables d'Environnement**

## **ğŸ“š Notions du jour**

Aujourdâ€™hui, nous avons corrigÃ© l'atelier d'hier en **pair-programming**.  
Pour rappel nous avons crÃ©Ã© un **site web dÃ©diÃ© aux films du studio Ghibli** en utilisant **Node.js, Express et EJS**.

Lors de la correction, notre enseignant nous a donnÃ© sa version pour la rÃ©alisation du projet et nous a montrÃ© comment **amÃ©liorer la structure**, **optimiser les performances**, et surtout, **utiliser des outils comme ESLint** pour garantir un code **propre et cohÃ©rent**.

Nous allons voir les points clÃ©s quâ€™il a abordÃ©s, ainsi que les corrections apportÃ©es Ã  notre projet "GhibliothÃ¨que".

<!-- more -->

---

### **ğŸ”§ Correction de lâ€™Atelier par lâ€™Enseignant : Bonnes Pratiques et Outils Indispensables**

---

### **ğŸ—ï¸ Pourquoi une Architecture Modulaire et MVC ?**
Hier, notre projet "GhibliothÃ¨que" fonctionnait, mais le code Ã©tait **peu organisÃ©** : les routes, la logique mÃ©tier et les vues Ã©taient mÃ©langÃ©es dans un seul fichier (`index.js`). Aujourdâ€™hui, nous avons **restructurÃ© le projet** en utilisant :
- **Router dâ€™Express** pour organiser les routes par domaine fonctionnel.
- **ContrÃ´leurs** pour sÃ©parer la logique mÃ©tier du routage.
- **Variables dâ€™environnement** pour gÃ©rer les configurations (comme le port du serveur).

**Avantages de cette architecture :**
âœ… **SÃ©paration des responsabilitÃ©s** : Chaque partie du code a un rÃ´le clair.
âœ… **MaintenabilitÃ©** : Plus facile Ã  modifier ou Ã©tendre.
âœ… **RÃ©utilisabilitÃ©** : Les contrÃ´leurs et routes peuvent Ãªtre rÃ©utilisÃ©s dans dâ€™autres projets.
âœ… **ScalabilitÃ©** : Ajouter de nouvelles fonctionnalitÃ©s devient plus simple.

---

### **ğŸ—ºï¸ Architecture Modulaire avec `express.Router`**
`express.Router` permet de **dÃ©couper les routes** par domaine (ex: films, utilisateurs) dans des fichiers sÃ©parÃ©s. Cela rend le code **plus lisible et modulaire**.

#### **ğŸ“– Ã‰tapes pour Organiser les Routes**
1. **CrÃ©er un dossier `routes/`** pour y placer les fichiers de routage.
2. **DÃ©placer les routes liÃ©es aux films** dans `routes/movies.js`.
3. **Importer et utiliser ces routes** dans `index.js`.

**Exemple de structure :**
```
ghibliothÃ¨que/
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ movies.js   # Routes liÃ©es aux films
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ movies.js   # Logique mÃ©tier pour les films
â”œâ”€â”€ views/          # Templates EJS
â”œâ”€â”€ data/           # DonnÃ©es des films
â””â”€â”€ index.js        # Point d'entrÃ©e
```

---
#### **1ï¸âƒ£ CrÃ©er un Fichier de Routes (`routes/movies.js`)**
```javascript
// routes/movies.js
import { Router } from 'express';
import {
  getAllMovies,
  getMovieById,
  getHomePage
} from '../controllers/movies.js';

const router = Router();

// Route pour la page d'accueil
router.get('/', getHomePage);

// Route pour la liste des films
router.get('/movies', getAllMovies);

// Route pour un film spÃ©cifique
router.get('/movies/:id', getMovieById);

export default router;
```

---
#### **2ï¸âƒ£ Importer les Routes dans `index.js`**
```javascript
// index.js
import express from 'express';
import moviesRouter from './routes/movies.js';

const app = express();

// Utiliser les routes des films
app.use('/', moviesRouter);
```

**Pourquoi câ€™est mieux ?**
- **`index.js` est plus lÃ©ger** : Il ne contient plus la logique des routes.
- **Les routes sont regroupÃ©es par domaine** : Plus facile Ã  maintenir.

---
### **ğŸ›ï¸ ContrÃ´leurs : SÃ©parer la Logique MÃ©tier**
Les **contrÃ´leurs** contiennent la logique pour traiter les requÃªtes (ex: rÃ©cupÃ©rer des films, formater les donnÃ©es). Ils sont appelÃ©s par les routes.

#### **ğŸ“– Exemple de ContrÃ´leur (`controllers/movies.js`)**
```javascript
// controllers/movies.js
import movies from '../data/movies.js';

// Page d'accueil : 3 films mis en avant
export function getHomePage(req, res) {
  const featuredMovies = movies.slice(0, 3);
  res.render('home', { movies: featuredMovies });
}

// Liste de tous les films
export function getAllMovies(req, res) {
  res.render('movies', { movies });
}

// DÃ©tails d'un film
export function getMovieById(req, res) {
  const movieId = parseInt(req.params.id);
  const movie = movies.find(m => m.id === movieId);

  if (!movie) {
    return res.status(404).render('404', { message: "Film non trouvÃ©" });
  }

  res.render('movie', { movie });
}
```

**Avantages :**
- **La logique mÃ©tier est isolÃ©e** : Les routes appellent simplement les fonctions du contrÃ´leur.
- **RÃ©utilisable** : Les mÃªmes fonctions peuvent Ãªtre utilisÃ©es par dâ€™autres routes ou mÃªme une API.

---
### **ğŸŒ Variables dâ€™Environnement avec `dotenv`**
Les **variables dâ€™environnement** permettent de configurer lâ€™application sans modifier le code (ex: changer le port du serveur, les clÃ©s API, etc.). Nous utilisons le package [`dotenv`](https://www.npmjs.com/package/dotenv) pour charger ces variables depuis un fichier `.env`.

#### **ğŸ“– Configuration de `dotenv`**
1. **Installer `dotenv`** :
   ```bash
   npm install dotenv
   ```

2. **CrÃ©er un fichier `.env`** Ã  la racine du projet :
   ```env
   PORT=3000
   NODE_ENV=development
   ```

3. **Charger les variables dans `index.js`** :
   ```javascript
   // index.js
   import 'dotenv/config'; // Charge les variables d'environnement

   const port = process.env.PORT || 3000; // Utilise PORT ou 3000 par dÃ©faut
   ```

4. **Utiliser `--env-file` pour spÃ©cifier un fichier `.env` personnalisÃ©** (optionnel) :
   ```bash
   node --env-file=.env.local index.js
   ```

**Pourquoi câ€™est utile ?**
- **SÃ©curitÃ©** : Les clÃ©s secrÃ¨tes (comme les mots de passe de base de donnÃ©es) ne sont pas dans le code.
- **FlexibilitÃ©** : On peut avoir des configurations diffÃ©rentes pour le dÃ©veloppement (`development`) et la production (`production`).

---
#### **ğŸ“– Exemple : Utiliser `NODE_ENV` pour des Configurations SpÃ©cifiques**
```javascript
// index.js
if (process.env.NODE_ENV === 'development') {
  console.log('Mode dÃ©veloppement activÃ© !');
  // Activer des middlewares de debug, etc.
}
```

**Fichier `.gitignore`** :
```
.env
node_modules/
```

---
### **ğŸ”„ Refactorisation ComplÃ¨te du Projet**
Voici la **nouvelle structure** du projet aprÃ¨s refactorisation :
```
ghibliothÃ¨que/
â”œâ”€â”€ .env                # Variables d'environnement
â”œâ”€â”€ controllers/        # Logique mÃ©tier
â”‚   â””â”€â”€ movies.js
â”œâ”€â”€ routes/             # Routes
â”‚   â””â”€â”€ movies.js
â”œâ”€â”€ views/              # Templates EJS
â”œâ”€â”€ data/               # DonnÃ©es
â”‚   â””â”€â”€ movies.js
â”œâ”€â”€ package.json
â””â”€â”€ index.js            # Point d'entrÃ©e
```

---
#### **ğŸ“– Nouveau Fichier `index.js` (SimplifiÃ©)**
```javascript
import 'dotenv/config';
import express from 'express';
import path from 'path';
import moviesRouter from './routes/movies.js';

const app = express();
const port = process.env.PORT || 3000;

// Configurer EJS et les fichiers statiques
app.set('view engine', 'ejs');
app.set('views', path.join(process.cwd(), 'views'));
app.use(express.static(path.join(process.cwd(), 'public')));

// Utiliser les routes
app.use('/', moviesRouter);

// Gestion des erreurs 404
app.use((req, res) => {
  res.status(404).render('404', { message: "Page non trouvÃ©e" });
});

// DÃ©marrer le serveur
app.listen(port, () => {
  console.log(`Server running on http://localhost:${port}`);
});
```

---
### **ğŸ’¡ Ce Que Jâ€™ai Appris Aujourdâ€™hui**
1. **`express.Router`** permet de **dÃ©couper les routes** par domaine fonctionnel, ce qui amÃ©liore la lisibilitÃ©.
2. **Les contrÃ´leurs** sÃ©parent la **logique mÃ©tier** des routes, rendant le code plus modulaire et rÃ©utilisable.
3. **Les variables dâ€™environnement** (`dotenv`) sont essentielles pour :
   - GÃ©rer les configurations sans modifier le code.
   - SÃ©curiser les informations sensibles (clÃ©s API, mots de passe).
4. **Lâ€™architecture MVC** (ModÃ¨le-Vue-ContrÃ´leur) est un standard pour organiser les applications web :
   - **ModÃ¨le** : Les donnÃ©es (`data/movies.js`).
   - **Vue** : Les templates (`views/`).
   - **ContrÃ´leur** : La logique mÃ©tier (`controllers/`).

---
### **ğŸš€ Prochaine Ã‰tape**
Demain, nous allons :
- **Ajouter une base de donnÃ©es** (comme MongoDB ou SQLite) pour stocker les films.
- **CrÃ©er une API REST** pour permettre des requÃªtes depuis un frontend ou un mobile.
- **ImplÃ©menter lâ€™authentification** pour protÃ©ger certaines routes.

**Et vous, utilisez-vous lâ€™architecture MVC dans vos projets ? Quels sont vos retours ?** ğŸ˜Š
*(Partagez vos astuces ou questions en commentaire !)*

**ğŸ“ Journal Dev : Refactorisation en Architecture MVC, Variables dâ€™Environnement et Introduction aux Linters avec ESLint !**

---

### **ğŸ”§ Correction de lâ€™Atelier par lâ€™Enseignant : Bonnes Pratiques et Outils Indispensables**
Lors de la correction, notre enseignant a **revu notre code** et nous a montrÃ© comment **amÃ©liorer la structure**, **optimiser les performances**, et surtout, **utiliser des outils comme ESLint** pour garantir un code **propre et cohÃ©rent**. Voici les points clÃ©s quâ€™il a abordÃ©s, ainsi que les corrections apportÃ©es Ã  notre projet "GhibliothÃ¨que".

---

### **ğŸ—ï¸ AmÃ©liorations Structurelles et Bonnes Pratiques**
#### **1. Organisation des Dossiers et Fichiers**
Lâ€™enseignant a insistÃ© sur lâ€™importance dâ€™une **structure claire et cohÃ©rente** pour faciliter la maintenance et la collaboration. Voici la structure **optimisÃ©e** quâ€™il a proposÃ©e :

```
ghibliothÃ¨que/
â”œâ”€â”€ .env                  # Variables d'environnement
â”œâ”€â”€ .eslintrc.js          # Configuration d'ESLint
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ public/               # Fichiers statiques (CSS, images, JS front)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/      # Logique mÃ©tier
â”‚   â”‚   â””â”€â”€ movies.js
â”‚   â”œâ”€â”€ routes/           # Routes Express
â”‚   â”‚   â””â”€â”€ movies.js
â”‚   â”œâ”€â”€ views/            # Templates EJS
â”‚   â”‚   â”œâ”€â”€ home.ejs
â”‚   â”‚   â”œâ”€â”€ movies.ejs
â”‚   â”‚   â”œâ”€â”€ movie.ejs
â”‚   â”‚   â”œâ”€â”€ 404.ejs
â”‚   â”‚   â””â”€â”€ partials/
â”‚   â”‚       â”œâ”€â”€ header.ejs
â”‚   â”‚       â””â”€â”€ footer.ejs
â”‚   â””â”€â”€ data/             # DonnÃ©es (Ã  remplacer par une base de donnÃ©es plus tard)
â”‚       â””â”€â”€ movies.js
â””â”€â”€ index.js              # Point d'entrÃ©e du serveur
```

**Pourquoi cette structure ?**
- **SÃ©paration claire** entre le code source (`src/`) et les fichiers statiques (`public/`).
- **Regroupement logique** des fichiers par fonctionnalitÃ© (contrÃ´leurs, routes, vues).
- **PrÃ©paration pour lâ€™ajout dâ€™une base de donnÃ©es** : Le dossier `data/` est temporaire et sera remplacÃ© par un modÃ¨le plus robuste (ex: MongoDB).

---

#### **2. Utilisation dâ€™un Linter : ESLint**
**Quâ€™est-ce quâ€™un linter ?**
Un **linter** est un outil qui **analyse votre code** pour dÃ©tecter :
- Des **erreurs de syntaxe**.
- Des **mauvaises pratiques** (ex: variables non utilisÃ©es).
- Des **problÃ¨mes de style** (ex: indentation incohÃ©rente).
- Des **bugs potentiels** (ex: variables non dÃ©clarÃ©es).

**ESLint** est le linter le plus populaire pour JavaScript. Il permet de **standardiser le code** selon des rÃ¨gles dÃ©finies (ex: [Airbnb Style Guide](https://github.com/airbnb/javascript)).

---
##### **ğŸ“– Installation et Configuration dâ€™ESLint**
1. **Installer ESLint** en dÃ©pendance de dÃ©veloppement :
   ```bash
   npm install --save-dev eslint
   ```

2. **Initialiser ESLint** dans le projet :
   ```bash
   npx eslint --init
   ```
   - RÃ©pondre aux questions pour configurer ESLint selon vos besoins (ex: "To check syntax, find problems, and enforce code style").
   - Choisir **JavaScript modules (import/export)**.
   - SÃ©lectionner un **style guide populaire** (ex: Airbnb).
   - Choisir **JSON** ou **JavaScript** pour le fichier de configuration.

3. **Fichier `.eslintrc.js` gÃ©nÃ©rÃ©** (exemple) :
   ```javascript
   module.exports = {
     env: {
       browser: true,
       es2021: true,
       node: true,
     },
     extends: [
       'airbnb-base',
     ],
     parserOptions: {
       ecmaVersion: 'latest',
       sourceType: 'module',
     },
     rules: {
       'no-console': 'off', // DÃ©sactive l'interdiction de console.log (utile en dev)
       'import/extensions': 'off', // DÃ©sactive l'obligation d'extensions dans les imports
     },
   };
   ```

4. **Ajouter un script NPM pour lancer ESLint** :
   ```json
   // package.json
   {
     "scripts": {
       "lint": "eslint .",
       "lint:fix": "eslint . --fix"  // Corrige automatiquement les erreurs simples
     }
   }
   ```

5. **Lancer ESLint** :
   ```bash
   npm run lint
   ```
   - Pour **corriger automatiquement** les erreurs simples :
     ```bash
     npm run lint:fix
     ```

---
##### **ğŸ“– Exemple de Correction par ESLint**
Avant ESLint :
```javascript
// index.js
import express from 'express'
import moviesRouter from './routes/movies.js'

const app=express()
const port = 3000

app.use('/', moviesRouter)

app.listen(port,()=>console.log(`Server running on http://localhost:${port}`))
```

AprÃ¨s ESLint (avec `--fix`) :
```javascript
// index.js
import express from 'express';
import moviesRouter from './routes/movies.js';

const app = express();
const port = 3000;

app.use('/', moviesRouter);

app.listen(port, () => {
  console.log(`Server running on http://localhost:${port}`);
});
```

**Corrections apportÃ©es :**
- Ajout de **points-virgules** manquants.
- Ajout dâ€™**espaces** autour des opÃ©rateurs (`=`, `=>`).
- **Indentation cohÃ©rente**.
- **Retours Ã  la ligne** pour une meilleure lisibilitÃ©.

---
##### **ğŸ’¡ Pourquoi Utiliser ESLint ?**
1. **Code cohÃ©rent** : Tout le monde sur le projet suit les mÃªmes rÃ¨gles.
2. **Moins de bugs** : DÃ©tection prÃ©coce des erreurs.
3. **Meilleure lisibilitÃ©** : Le code est plus facile Ã  relire.
4. **IntÃ©gration avec les outils** : ESLint sâ€™intÃ¨gre avec VS Code, GitHub Actions, etc.

---
##### **ğŸ“– Configuration AvancÃ©e : Ignorer des Fichiers ou Dossiers**
Pour ignorer certains fichiers (ex: `node_modules/`), crÃ©er un fichier `.eslintignore` :
```
node_modules/
public/
```

---
##### **ğŸ“– IntÃ©gration avec VS Code**
1. Installer lâ€™extension **[ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)**.
2. VS Code **affiche les erreurs en temps rÃ©el** et propose des corrections.

**Exemple de configuration VS Code (`settings.json`) :**
```json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "eslint.validate": ["javascript"]
}
```

---
### **ğŸ”„ Corrections ApportÃ©es par lâ€™Enseignant**
#### **1. Optimisation des Routes avec `express.Router`**
Lâ€™enseignant a **revu notre fichier `routes/movies.js`** pour le rendre plus **modulaire et clair** :
- **Regrouper les routes liÃ©es** (ex: `/movies` et `/movies/:id`).
- **Utiliser des noms de fonctions explicites** dans les contrÃ´leurs.

**Version corrigÃ©e de `routes/movies.js` :**
```javascript
// routes/movies.js
import { Router } from 'express';
import {
  getHomePage,
  getAllMovies,
  getMovieById,
} from '../controllers/movies.js';

const router = Router();

// Route pour la page d'accueil
router.get('/', getHomePage);

// Routes pour les films
router.get('/movies', getAllMovies);
router.get('/movies/:id', getMovieById);

export default router;
```

---
#### **2. AmÃ©lioration des ContrÃ´leurs**
Les contrÃ´leurs ont Ã©tÃ© **simplifiÃ©s et clarifiÃ©s** :
- **SÃ©paration des responsabilitÃ©s** : Chaque fonction fait une seule chose.
- **Gestion des erreurs** : Utilisation de `try/catch` pour les opÃ©rations asynchrones (mÃªme si ici, les donnÃ©es sont statiques).

**Version corrigÃ©e de `controllers/movies.js` :**
```javascript
// controllers/movies.js
import movies from '../data/movies.js';

// Page d'accueil : 3 films mis en avant
export function getHomePage(req, res) {
  try {
    const featuredMovies = movies.slice(0, 3);
    res.render('home', { movies: featuredMovies });
  } catch (error) {
    console.error("Error in getHomePage:", error);
    res.status(500).render('404', { message: "Erreur serveur" });
  }
}

// Liste de tous les films
export function getAllMovies(req, res) {
  try {
    res.render('movies', { movies });
  } catch (error) {
    console.error("Error in getAllMovies:", error);
    res.status(500).render('404', { message: "Erreur serveur" });
  }
}

// DÃ©tails d'un film
export function getMovieById(req, res) {
  try {
    const movieId = parseInt(req.params.id, 10);
    const movie = movies.find((m) => m.id === movieId);

    if (!movie) {
      return res.status(404).render('404', { message: "Film non trouvÃ©" });
    }

    res.render('movie', { movie });
  } catch (error) {
    console.error("Error in getMovieById:", error);
    res.status(500).render('404', { message: "Erreur serveur" });
  }
}
```

**AmÃ©liorations apportÃ©es :**
- **Gestion des erreurs** avec `try/catch`.
- **Conversion explicite en base 10** (`parseInt(req.params.id, 10)`) pour Ã©viter les bugs.
- **Logs dâ€™erreur** pour faciliter le dÃ©bogage.

---
#### **3. Variables dâ€™Environnement et SÃ©curitÃ©**
Lâ€™enseignant a soulignÃ© lâ€™importance de **ne jamais commiter les fichiers `.env`** (qui contiennent des secrets) et dâ€™utiliser `.gitignore` pour les exclure.

**Exemple de `.env` amÃ©liorÃ© :**
```env
# .env
PORT=3000
NODE_ENV=development
# Future variable pour une base de donnÃ©es
DB_URI=mongodb://localhost:27017/ghibli
```

**Exemple de `.gitignore` :**
```
.env
node_modules/
.DS_Store
```

---
#### **4. Utilisation de `express.static` pour les Fichiers Statiques**
Lâ€™enseignant a **optimisÃ© la configuration** des fichiers statiques pour Ã©viter les conflits de chemins :
```javascript
// index.js
import path from 'path';

// Servir les fichiers statiques depuis 'public'
app.use(express.static(path.join(process.cwd(), 'public')));
// Servir les images depuis 'public/img' via '/img'
app.use('/img', express.static(path.join(process.cwd(), 'public/img')));
```

**Pourquoi ?**
- **ClartÃ©** : Les URLs comme `/img/film.jpg` sont plus explicites.
- **SÃ©curitÃ©** : On contrÃ´le mieux quels fichiers sont accessibles.

---
### **ğŸ’¡ Ce Que Jâ€™ai Appris de la Correction**
1. **Lâ€™importance des linters** : ESLint **amÃ©liore la qualitÃ© du code** et **rÃ©duit les bugs**.
2. **Une architecture MVC bien organisÃ©e** rend le code **plus maintenable**.
3. **La gestion des erreurs** est cruciale, mÃªme pour des projets simples.
4. **Les variables dâ€™environnement** permettent de **sÃ©curiser les configurations** et de les adapter Ã  diffÃ©rents environnements (dev, prod).
5. **Les bonnes pratiques** (comme les `try/catch`, les noms de fonctions clairs) **facilitent la collaboration**.

---

**ğŸ“ Journal Dev : AmÃ©lioration de la GhibliothÃ¨que â€“ Nouvelles Routes et Gestion des Erreurs !**

---

### **ğŸ¬ PrÃ©sentation du Challenge**
Aujourdâ€™hui, nous avons **enrichi notre application GhibliothÃ¨que** en ajoutant de **nouvelles fonctionnalitÃ©s** :
1. Une route pour afficher les **5 films les plus rÃ©cents**.
2. Une route pour **filtrer les films par rÃ©alisateur**.
3. Un **bonus** : une route pour lister tous les rÃ©alisateurs et le nombre de leurs films.

Lâ€™objectif Ã©tait dâ€™utiliser **lâ€™architecture MVC** que nous avons apprise hier, tout en **gÃ©rant les erreurs** (comme les URLs mal encodÃ©es).

---

### **ğŸ“Œ Ã‰tapes Ã  RÃ©aliser**

#### **1ï¸âƒ£ Route des Films RÃ©cents (`/movies/recent`)**
**Objectif :** Afficher les **5 films les plus rÃ©cents**, triÃ©s par date de sortie.

**Mon code :**
*(InsÃ©rer ici ton bloc de code pour la route `/movies/recent` et le contrÃ´leur associÃ©. Par exemple :)*

**Route dans `routes/movies.js` :**
```javascript
// routes/movies.js
import { Router } from 'express';
import {
  getHomePage,
  getAllMovies,
  getMovieById,
  getRecentMovies,
} from '../controllers/movies.js';

const router = Router();

// Route pour les films rÃ©cents
router.get('/movies/recent', getRecentMovies);

// ... (autres routes existantes)

export default router;
```

**ContrÃ´leur dans `controllers/movies.js` :**
```javascript
// controllers/movies.js
export function getRecentMovies(req, res) {
  try {
    // Copier le tableau pour Ã©viter de modifier l'original
    const sortedMovies = [...movies].toSorted((a, b) => {
      const dateA = new Date(a.year, 0, 1); // On suppose que l'annÃ©e est suffisante pour le tri
      const dateB = new Date(b.year, 0, 1);
      return dateB - dateA; // Tri dÃ©croissant (du plus rÃ©cent au plus ancien)
    });

    const recentMovies = sortedMovies.slice(0, 5); // Prendre les 5 premiers
    res.render('movies', {
      title: "Films RÃ©cents",
      movies: recentMovies,
    });
  } catch (error) {
    console.error("Error in getRecentMovies:", error);
    res.status(500).render('404', { message: "Erreur serveur" });
  }
}
```

**Explications :**
- **`toSorted()`** : Trie le tableau **sans modifier lâ€™original** (contrairement Ã  `sort()`).
- **`new Date()`** : Convertit les annÃ©es en objets `Date` pour un tri prÃ©cis.
- **`slice(0, 5)`** : SÃ©lectionne les **5 films les plus rÃ©cents**.

---
#### **2ï¸âƒ£ Filtrage par RÃ©alisateur (`/director/:directorName`)**
**Objectif :** Afficher les films dâ€™un **rÃ©alisateur spÃ©cifique**.

**Mon code :**
*(InsÃ©rer ici ton bloc de code pour la route `/director/:directorName` et le contrÃ´leur associÃ©. Par exemple :)*

**Route dans `routes/movies.js` :**
```javascript
// routes/movies.js
router.get('/director/:directorName', getMoviesByDirector);
```

**ContrÃ´leur dans `controllers/movies.js` :**
```javascript
// controllers/movies.js
export function getMoviesByDirector(req, res) {
  try {
    const directorName = decodeURIComponent(req.params.directorName);
    const directorMovies = movies.filter((movie) =>
      movie.director.toLowerCase() === directorName.toLowerCase()
    );

    if (directorMovies.length === 0) {
      return res.status(404).render('404', {
        message: `Aucun film trouvÃ© pour le rÃ©alisateur : ${directorName}`,
      });
    }

    res.render('movies', {
      title: `Films de ${directorName}`,
      movies: directorMovies,
    });
  } catch (error) {
    if (error instanceof URIError) {
      return res.status(404).render('404', { message: "URL invalide" });
    }
    console.error("Error in getMoviesByDirector:", error);
    res.status(500).render('404', { message: "Erreur serveur" });
  }
}
```

**DifficultÃ©s rencontrÃ©es :**
- **Gestion des URLs mal encodÃ©es** : Si lâ€™utilisateur entre une URL comme `/director/Hayao Miyazaki` (avec un espace non encodÃ©), Node.js gÃ©nÃ¨re une `URIError`.
  **Solution** : Utiliser `decodeURIComponent()` pour dÃ©coder lâ€™URL et un **middleware dâ€™erreur global** pour capturer les `URIError`.

**Middleware dâ€™erreur global (dans `index.js`) :**
```javascript
// index.js
app.use((err, req, res, next) => {
  if (err instanceof URIError) {
    return res.status(404).render('404', { message: "URL invalide" });
  }
  // Gestion d'autres erreurs
  console.error(err);
  res.status(500).render('404', { message: "Erreur serveur" });
});
```

---
#### **3ï¸âƒ£ Bonus : Liste des RÃ©alisateurs (`/directors`)**
**Objectif :** Lister tous les rÃ©alisateurs et le nombre de leurs films.

**Mon code :**
*(InsÃ©rer ici ton bloc de code pour la route `/directors` et le contrÃ´leur associÃ©. Par exemple :)*

**Route dans `routes/movies.js` :**
```javascript
// routes/movies.js
router.get('/directors', getDirectorsList);
```

**ContrÃ´leur dans `controllers/movies.js` :**
```javascript
// controllers/movies.js
export function getDirectorsList(req, res) {
  try {
    const directors = {};

    movies.forEach((movie) => {
      if (!directors[movie.director]) {
        directors[movie.director] = 1;
      } else {
        directors[movie.director]++;
      }
    });

    res.json(directors);
  } catch (error) {
    console.error("Error in getDirectorsList:", error);
    res.status(500).json({ error: "Erreur serveur" });
  }
}
```

**RÃ©sultat attendu :**
```json
{
  "Hayao Miyazaki": 11,
  "Isao Takahata": 5,
  "Hiroyuki Morita": 1,
  ...
}
```

---
### **ğŸ–¥ï¸ Rendu Final des Nouvelles FonctionnalitÃ©s**
*(InsÃ©rer ici des captures dâ€™Ã©cran ou des exemples de sortie pour chaque route :)*

1. **Route `/movies/recent`** :
   *(Capture dâ€™Ã©cran ou exemple de rendu avec les 5 films les plus rÃ©cents.)*

2. **Route `/director/Hayao%20Miyazaki`** :
   *(Capture dâ€™Ã©cran ou exemple de rendu avec les films de Hayao Miyazaki.)*

3. **Route `/directors`** :
   *(Capture dâ€™Ã©cran ou exemple de sortie JSON avec la liste des rÃ©alisateurs et leurs comptes de films.)*

---
### **ğŸ’¡ Ce Que Jâ€™ai Appris avec ce Challenge**
1. **Tri de donnÃ©es** : Utiliser `toSorted()` et `Date` pour trier des films par annÃ©e.
2. **Filtrage dynamique** : Utiliser `filter()` et `toLowerCase()` pour une recherche insensible Ã  la casse.
3. **Gestion des erreurs** :
   - Capturer les `URIError` avec un middleware global.
   - Utiliser `decodeURIComponent()` pour dÃ©coder les paramÃ¨tres dâ€™URL.
4. **Manipulation de donnÃ©es** : Compter les occurrences avec un objet et une boucle `forEach`.
5. **RÃ©utilisation des vues** : La mÃªme vue (`movies.ejs`) peut afficher diffÃ©rents ensembles de films (rÃ©cents, par rÃ©alisateur).

---
### **ğŸš€ Prochaine Ã‰tape**
Demain, nous allons :
- **Ajouter une base de donnÃ©es** (MongoDB) pour stocker les films de maniÃ¨re persistante.
- **CrÃ©er un formulaire** pour ajouter de nouveaux films.
- **ImplÃ©menter une recherche par titre** pour trouver des films rapidement.

**Et vous, comment gÃ©rez-vous les erreurs dâ€™URL dans vos projets ?** ğŸ˜Š
*(Partagez vos astuces ou retours dâ€™expÃ©rience en commentaire !)*
