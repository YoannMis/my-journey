---
date:
  created: 2025-11-05
draft: true
---

# **üìÖ SAISON B Semaine 1 √âpisode 3 - Les Routes avec Express**

## **üìö Notions du jour**

+ Routes et routes dynamiques (=param√®tr√©es)

<!-- more -->

---

### **üöÄ Pourquoi les Routes sont le C≈ìur d‚ÄôExpress ?**

Avec Express, tout tourne autour des **routes** : ce sont les **URLs** que votre application peut g√©rer, et les **actions** associ√©es (comme afficher une page, retourner des donn√©es JSON, ou traiter un formulaire). Aujourd‚Äôhui, j‚Äôai plong√© dans la **gestion des routes**, y compris les **routes dynamiques** (ou param√©tr√©es), qui permettent de cr√©er des URLs flexibles et puissantes.

---

### **üìå Les Bases : D√©finir des Routes Statiques**

Les routes statiques sont les plus simples : elles r√©pondent √† une **URL fixe** avec une **r√©ponse fixe**. Par exemple, une page d‚Äôaccueil (`/`) ou une page "Contact" (`/contact`).

#### **üìñ Exemple : Routes Statiques de Base**

```javascript title="JavaScript"
import express from 'express';
const app = express();
const port = 3000;

// Homepage route
app.get('/', (req, res) => {
  res.send('Welcome to the homepage!');
});

// About page route
app.get('/contact', (req, res) => {
  res.send('Contact Us!');
});

// Start the server
app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

**Explications :**

+ **`app.get()`** : D√©finit une route qui r√©pond aux requ√™tes **GET** (quand un utilisateur acc√®de √† l‚ÄôURL dans son navigateur).
+ **`(req, res)`** : Deux objets cl√©s :
  + `req` (*request*) : Contient les donn√©es de la requ√™te (param√®tres, headers, etc.).
  + `res` (*response*) : Permet d‚Äôenvoyer une r√©ponse (texte, HTML, JSON, etc.).
+ **`res.send()`** : Envoie une r√©ponse texte simple.

---

### **üîÑ Les Routes Dynamiques : Des URLs Param√©tr√©es**

Les routes dynamiques permettent de **capturer des valeurs dans l‚ÄôURL** pour les utiliser dans votre code. Par exemple, afficher le profil d‚Äôun utilisateur avec `/users/123`, o√π `123` est l‚ÄôID de l‚Äôutilisateur.

#### **üìñ Syntaxe des Routes Dynamiques**

```javascript
// Route with a dynamic parameter
app.get('/users/:userId', (req, res) => {
  const userId = req.params.userId; // Access the dynamic parameter
  res.send(`User ID: ${userId}`);
});
```

**Exemple d‚ÄôURL :**

+ `/users/42` ‚Üí R√©pond : `"User ID: 42"`.

**Comment √ßa marche ?**

+ **`:userId`** : Un **param√®tre dynamique** dans l‚ÄôURL. Le nom apr√®s `:` (`userId`) est arbitraire (vous pouvez utiliser `:id`, `:name`, etc.).
+ **`req.params`** : Un objet qui contient **tous les param√®tres dynamiques** de l‚ÄôURL. Ici, `req.params.userId` r√©cup√®re la valeur de `:userId`.

---

#### **üìñ Exemple Avanc√© : Route avec Plusieurs Param√®tres**

```javascript
// Route with multiple dynamic parameters
app.get('/users/:userId/posts/:postId', (req, res) => {
  const { userId, postId } = req.params;
  res.send(`User ${userId}, Post ${postId}`);
});
```

**Exemple d‚ÄôURL :**

+ `/users/42/posts/5` ‚Üí R√©pond : `"User 42, Post 5"`.

---

### **üó∫Ô∏è Routes Dynamiques avec des Param√®tres Optionnels**

Parfois, vous voulez qu‚Äôun param√®tre soit **optionnel**. Pour cela, vous pouvez utiliser des **expressions r√©guli√®res** dans la d√©finition de la route.

#### **üìñ Exemple : Param√®tre Optionnel**

```javascript
// Route with an optional parameter
app.get('/blog/:year?/:month?', (req, res) => {
  const { year, month } = req.params;
  if (year && month) {
    res.send(`Blog posts from ${year}/${month}`);
  } else if (year) {
    res.send(`Blog posts from ${year}`);
  } else {
    res.send('All blog posts');
  }
});
```

**Explications :**

+ **`:year?`** : Le `?` rend le param√®tre **optionnel**.
+ La logique dans le callback v√©rifie quels param√®tres sont pr√©sents pour adapter la r√©ponse.

**Exemples d‚ÄôURLs :**

+ `/blog/2023/10` ‚Üí `"Blog posts from 2023/10"`.
+ `/blog/2023` ‚Üí `"Blog posts from 2023"`.
+ `/blog` ‚Üí `"All blog posts"`.

---

### **üîç Routes avec des Contraintes (Regex)**

Vous pouvez aussi **restreindre le format des param√®tres** en utilisant des **expressions r√©guli√®res** dans la d√©finition de la route. Par exemple, pour accepter uniquement des nombres dans un param√®tre.

#### **üìñ Exemple : Param√®tre Num√©rique Obligatoire**

```javascript
// Route with a numeric parameter constraint
app.get('/products/:productId(\\d+)', (req, res) => {
  const productId = req.params.productId;
  res.send(`Product ID: ${productId} (must be a number)`);
});
```

**Explications :**

+ **`(\\d+)`** : Une regex qui impose que `productId` soit **compos√© uniquement de chiffres** (`\d` = digit, `+` = un ou plusieurs).
+ Si l‚ÄôURL ne correspond pas (ex: `/products/abc`), Express **ne d√©clenchera pas cette route** et passera √† la suivante (ou retournera une 404).

**Exemple d‚ÄôURL valide :**

+ `/products/123` ‚Üí R√©pond : `"Product ID: 123 (must be a number)"`.

---

### **üìÇ Routes et Middlewares : Ajouter des Fonctionnalit√©s**

Les routes peuvent aussi utiliser des **middlewares** pour ajouter des fonctionnalit√©s (comme la validation, l‚Äôauthentification, ou le logging).

#### **üìñ Exemple : Middleware pour Logger les Requ√™tes**

```javascript
// Logger middleware
app.use((req, res, next) => {
  console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);
  next(); // Pass control to the next middleware/route
});

// Route using the logger
app.get('/secret', (req, res) => {
  res.send('This is a secret page!');
});
```

**Explications :**

+ **`app.use()`** : Applique le middleware √† **toutes les requ√™tes**.
+ **`next()`** : Passe le contr√¥le au middleware/route suivant.
+ Ici, chaque requ√™te est logu√©e avec sa m√©thode (`GET`, `POST`, etc.) et son URL.

---

### **üí° Bonnes Pratiques pour les Routes Express**

1. **Organiser les routes** :
   + Utilisez `express.Router()` pour regrouper les routes li√©es (ex: toutes les routes `/users` dans un fichier s√©par√©).

   ```javascript
   // users.js
   import { Router } from 'express';
   const router = Router();

   router.get('/', (req, res) => {
     res.send('List of users');
   });

   router.get('/:id', (req, res) => {
     res.send(`User ${req.params.id}`);
   });

   export default router;
   ```

   ```javascript
   // index.js
   import userRouter from './users.js';
   app.use('/users', userRouter); // All routes in userRouter are prefixed with '/users'
   ```

2. **Valider les param√®tres** :
   + Utilisez des middlewares comme `express-validator` pour valider les donn√©es des requ√™tes.

3. **G√©rer les erreurs** :
   + Ajoutez un middleware de gestion d‚Äôerreurs √† la fin de votre application.

   ```javascript
   app.use((err, req, res, next) => {
     console.error(err.stack);
     res.status(500).send('Something broke!');
   });
   ```

4. **Utiliser des verbes HTTP appropri√©s** :
   + `GET` pour r√©cup√©rer des donn√©es.
   + `POST` pour cr√©er une ressource.
   + `PUT`/`PATCH` pour mettre √† jour.
   + `DELETE` pour supprimer.

---

### **üöÄ Ce Que J‚Äôai Appris Aujourd‚Äôhui**

1. **Les routes statiques** sont parfaites pour des pages simples et fixes.
2. **Les routes dynamiques** permettent de cr√©er des URLs flexibles avec des param√®tres (ex: `/users/:id`).
3. **Les expressions r√©guli√®res** dans les routes ajoutent des contraintes pour valider les param√®tres.
4. **Les middlewares** peuvent enrichir les routes avec des fonctionnalit√©s comme le logging ou la validation.
5. **L‚Äôorganisation du code** est cruciale : utiliser `express.Router()` pour s√©parer les routes par domaine (ex: utilisateurs, produits).

---

**‚å®Ô∏è Challenge du jour : "Capitales du Monde" ‚Äì Afficher les Fuseaux Horaires avec Express et l‚ÄôAPI `Intl` !**

---

### **üé§ Pr√©sentation du Challenge**

Aujourd‚Äôhui, le d√©fi √©tait de cr√©er un **site web simple** avec Express pour afficher une **liste de capitales** et leurs **fuseaux horaires**. L‚Äôobjectif √©tait d‚Äôutiliser :

+ Un **module JavaScript** (`capital-cities.js`) contenant les donn√©es des capitales.
+ Un **template HTML** (`homePageTemplate`) pour afficher la liste des capitales sur la page d‚Äôaccueil.
+ L‚Äô**API `Intl`** pour g√©rer les dates et heures dans les fuseaux horaires des capitales.
+ Des **routes dynamiques** pour afficher les d√©tails de chaque capitale (nom, jour, heure locale).

**Donn√©es fournies :**

+ **`capital-cities.js`** : Un tableau d‚Äôobjets avec le nom des capitales et leurs fuseaux horaires.
+ **`template.js`** : Un template HTML pour la page d‚Äôaccueil (`homePageTemplate`).

---

### **üéØ Objectif du Challenge**

1. **Initialiser un projet Node.js** avec Express.
2. **Afficher une liste de capitales** sur la page d‚Äôaccueil (`/`).
3. **Cr√©er une route dynamique** (`/capitale/:nom`) pour afficher :
   + Le nom de la capitale.
   + Le **jour et l‚Äôheure actuelle** dans son fuseau horaire.
4. **Utiliser l‚ÄôAPI `Intl`** pour formater les dates et heures en **fran√ßais**.

---

### **üìå √âtapes √† R√©aliser**

#### **1Ô∏è‚É£ Initialisation du Projet et Installation d‚ÄôExpress**

**Objectif :** Cr√©er un projet Node.js et installer Express.

**Mon code :**
*(Ins√©rer ici ton bloc de code pour l‚Äôinitialisation du projet et l‚Äôinstallation d‚ÄôExpress. Par exemple :)*

```bash
# Initialiser le projet et installer Express
npm init -y
npm install express
```

**Configurer le `package.json` pour utiliser les modules ES6 :**

```json
{
  "name": "capitales-du-monde",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node index.js",
    "dev": "node --watch index.js"
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
```

---

#### **2Ô∏è‚É£ Importer les Donn√©es et le Template**

**Objectif :** Importer les donn√©es des capitales et le template HTML pour la page d‚Äôaccueil.

**Mon code :**
*(Ins√©rer ici ton bloc de code pour importer les donn√©es et le template. Par exemple :)*

```javascript
// index.js
import express from 'express';
import { capitalCities } from './modules/capital-cities.js';
import { homePageTemplate } from './modules/template.js';

const app = express();
const port = 3000;
```

---

#### **3Ô∏è‚É£ Cr√©er la Route pour la Page d‚ÄôAccueil (`/`)**

**Objectif :** Afficher la liste des capitales avec des liens vers leurs pages d√©taill√©es.

**Mon code :**
*(Ins√©rer ici ton bloc de code pour la route `/`. Par exemple :)*

```javascript
// Route pour la page d'accueil
app.get('/', (req, res) => {
  res.send(homePageTemplate(capitalCities));
});
```

---

#### **4Ô∏è‚É£ Cr√©er une Route Dynamique pour les Capitales (`/capitale/:nom`)**

**Objectif :** Afficher le nom de la capitale, le jour et l‚Äôheure actuelle dans son fuseau horaire.

**Mon code :**
*(Ins√©rer ici ton bloc de code pour la route dynamique `/capitale/:nom`. Par exemple :)*

```javascript
// Route dynamique pour afficher les d√©tails d'une capitale
app.get('/capitale/:nom', (req, res) => {
  const cityName = decodeURIComponent(req.params.nom);
  const city = capitalCities.find(c => c.name === cityName);

  if (!city) {
    return res.status(404).send("Capitale non trouv√©e.");
  }

  // R√©cup√©rer la date et l'heure dans le fuseau horaire de la capitale
  const now = new Date();
  const options = {
    timeZone: city.timezone,
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  };

  const formattedDate = now.toLocaleDateString('fr-FR', options);
  const formattedTime = now.toLocaleTimeString('fr-FR', {
    timeZone: city.timezone,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });

  // Template pour la page de la capitale
  const capitalPage = `
    <!DOCTYPE html>
    <html lang="fr">
    <head>
      <meta charset="UTF-8">
      <title>${city.name}</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        p { font-size: 1.2em; }
      </style>
    </head>
    <body>
      <h1>${city.name}</h1>
      <p>Nous sommes le <strong>${formattedDate}</strong>.</p>
      <p>Il est actuellement <strong>${formattedTime}</strong> √† ${city.name}.</p>
      <a href="/">Retour √† la liste des capitales</a>
    </body>
    </html>
  `;

  res.send(capitalPage);
});
```

---

#### **5Ô∏è‚É£ Utiliser l‚ÄôAPI `Intl` pour les Dates et Heures**

**Objectif :** Formater les dates et heures dans le fuseau horaire de la capitale, en fran√ßais.

**Explications :**

+ **`toLocaleDateString()`** : Formate une date selon une locale (ici, `fr-FR`).
+ **`toLocaleTimeString()`** : Formate une heure selon une locale.
+ **`timeZone`** : Sp√©cifie le fuseau horaire (ex: `"Europe/Paris"`).

**Exemple d‚Äôutilisation :**

```javascript
const now = new Date();
const options = {
  timeZone: 'Europe/Paris',
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric'
};
console.log(now.toLocaleDateString('fr-FR', options));
// Exemple de sortie : "lundi 10 octobre 2025"
```

---

### **üñ•Ô∏è Rendu Final du Site Web**

*(Ins√©rer ici des captures d‚Äô√©cran ou des exemples de sortie pour chaque page :)*

---

### **üí° Ce Que J‚Äôai Appris avec ce Challenge**

1. **Utiliser Express pour cr√©er des routes dynamiques** : Les param√®tres d‚ÄôURL (`:nom`) permettent de rendre les routes flexibles.
2. **L‚ÄôAPI `Intl` est puissante** pour formater des dates et heures selon des fuseaux horaires et des locales sp√©cifiques.
3. **S√©parer les donn√©es et les templates** : Utiliser des modules externes (`capital-cities.js`, `template.js`) rend le code plus **modulaire et maintenable**.

---

utilisation m√©thode find() pour rechercher la timezone avec la m√©thode toLowerCase().
