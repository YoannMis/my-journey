---
date:
  created: 2025-11-06
draft: true
---

# **ğŸ“… SAISON B Semaine 1 Ã‰pisode 4 - EJS et `express.static` â€“ Des Templates Dynamiques et des Fichiers Statiques avec Express !**

## **ğŸ“š Notions du jour**

+ EJS : moteur de template
+ syntaxe EJS <% %> (notamment include, la solution anti-DRY)
+ express.static pour les contenus statiques (css, js front, images...)

<!-- more -->

---

## **ğŸ¨ Pourquoi Utiliser un Moteur de Templates comme EJS ?**

Jusquâ€™Ã  prÃ©sent, avec Express, jâ€™envoyais du **HTML statique** ou des chaÃ®nes de caractÃ¨res construites Ã  la main. Mais pour des applications dynamiques, cela devient vite **lourd et rÃ©pÃ©titif**. Câ€™est lÃ  quâ€™intervient **EJS** (*Embedded JavaScript*), un **moteur de templates** qui permet dâ€™injecter du **JavaScript dans du HTML**, pour gÃ©nÃ©rer des pages dynamiques **proprement et efficacement**.

**Avantages dâ€™EJS :**

+ **Ã‰vite la rÃ©pÃ©tition de code** (principe **DRY** : *Donâ€™t Repeat Yourself*).
+ **SÃ©pare la logique mÃ©tier** (JavaScript) de la **prÃ©sentation** (HTML).
+ **Permet dâ€™inclure des fichiers partiels** (headers, footers, etc.).
+ **Facile Ã  prendre en main** avec une syntaxe simple (`<% %>`, `<%= %>`).

---

### **ğŸ“¦ Installation et Configuration dâ€™EJS avec Express**

Pour utiliser EJS avec Express, il faut :

1. **Installer EJS** via npm.
2. **Configurer Express** pour utiliser EJS comme moteur de templates.

#### **ğŸ“– Ã‰tapes dâ€™Installation et Configuration**

1. **Installer EJS** :

   ```bash title="Bash"
   npm install ejs
   ```

2. **Configurer Express** pour utiliser EJS :

   ```javascript title="JavaScript"
   import express from 'express';
   const app = express();

   // Define EJS as template engine
   app.set('view engine', 'ejs');
   // Set the views folder (default: 'views')
   app.set('views', './views');
   ```

3. **CrÃ©er un dossier `views/`** Ã  la racine du projet pour y placer les fichiers `.ejs`.

---

### **ğŸ“ Syntaxe de Base dâ€™EJS**

EJS utilise des **balises spÃ©ciales** pour injecter du JavaScript dans le HTML :

| Syntaxe          | Description                                                                 | Exemple                          |
|------------------|-----------------------------------------------------------------------------|----------------------------------|
| `<% code %>`     | ExÃ©cute du code JavaScript (sans affichage).                               | `<% if (user) { %>`              |
| `<%= value %>`   | Affiche la valeur dâ€™une variable (Ã©chappÃ© pour Ã©viter les XSS).           | `<h1><%= title %></h1>`           |
| `<%- value %>`   | Affiche la valeur **sans Ã©chappement** (pour du HTML brut).               | `<%- htmlContent %>`            |
| `<%# comment %>` | Commentaire (ignorÃ© par le moteur).                                         | `<%# Ce code est un commentaire %>` |
| `<% include file %>` | Inclut un fichier partiel (ex: header, footer).                      | `<% include('partials/header') %>` |

---

#### **ğŸ“– Exemple : Afficher une Variable dans un Template**

**Fichier `views/index.ejs` :**

```html title="views/index.ejs" hl_lines="5 8"
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>
</head>
<body>
  <h1>Welcome, <%= user.name %>!</h1>
</body>
</html>
```

**Code Express pour rendre le template :**

```javascript title="routers/index.router.js"
import { Router } from "express";
import { cityDetail, homePage } from "../controllers/main.controller.js";

// The router will allow me to define routes separate from my main application
// the `router` replaces the `app` in the route definition
export const router = Router();

router.get('/', (req, res) => {
  res.render('index', {
    title: 'Home Page',
    user: { name: 'Yoann' }
  });
});
```

```javascript title="index.js"
import express from 'express';
import { router } from './src/routers/index.router.js';

const app = express();
const port = 3000;

app.set('view engine', 'ejs');
app.set('views', './src/views');

// We tell our application to use the router that we have defined
app.use(router);

app.listen(3000, () => {
  console.log(`Server is running on http://localhost:${port}`);
});
```

**RÃ©sultat HTML gÃ©nÃ©rÃ© :**

```html title="HTML gÃ©nÃ©rÃ© par le serveur" hl_lines="5 8"
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Home Page</title>
</head>
<body>
  <h1>Welcome, Yoann!</h1>
</body>
</html>
```

---

### **ğŸ”„ La Solution Anti-DRY : Les Partiels avec `<% include %>**

Les **partiels** (*partials*) sont des **fichiers EJS rÃ©utilisables** (comme un header ou un footer). Ils Ã©vitent de rÃ©pÃ©ter le mÃªme code dans plusieurs templates.

#### **ğŸ“– Exemple : CrÃ©er un Header et un Footer RÃ©utilisables**

1. **CrÃ©er un dossier `views/partials/`** pour y placer les partiels.
2. **Fichier `views/partials/header.ejs` :**

   ```html
   <header>
     <nav>
       <a href="/">Home</a>
       <a href="/about">About</a>
     </nav>
   </header>
   ```

3. **Fichier `views/partials/footer.ejs` :**

   ```html
   <footer>
     <p>&copy; 2025 My Express App</p>
   </footer>
   ```

4. **Utiliser les partiels dans `views/index.ejs` :**

   ```html
   <!DOCTYPE html>
   <html lang="fr">
   <head>
     <meta charset="UTF-8">
     <title><%= title %></title>
   </head>
   <body>
     <% include('partials/header') %>

     <main>
       <h1>Welcome, <%= user.name %>!</h1>
     </main>

     <% include('partials/footer') %>
   </body>
   </html>
   ```

**Avantages :**

+ **Un seul endroit Ã  modifier** pour mettre Ã  jour le header/footer.
+ **Code plus propre et maintenable**.

---

### **ğŸ“ GÃ©rer les Fichiers Statiques avec `express.static`**

Les fichiers statiques (CSS, JavaScript, images) ne changent pas dynamiquement. Express permet de les servir facilement avec le middleware **`express.static`**.

#### **ğŸ“– Configuration de `express.static`**

```javascript
import express from 'express';
import path from 'path';

const app = express();

// Servir les fichiers statiques depuis le dossier 'public'
app.use(express.static(path.join(process.cwd(), 'public')));
```

**Structure du projet :**

```bash
ğŸ“src/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ script.js
â”‚   â””â”€â”€ images/
â”‚       â””â”€â”€ logo.png
â”œâ”€â”€ views/
â”‚   â””â”€â”€ index.ejs
â””â”€â”€ index.js
```

**Exemple dâ€™utilisation dans un template EJS :**

```html
<!-- Dans views/index.ejs -->
<link rel="stylesheet" href="/css/style.css">
<script src="/js/script.js"></script>
<img src="/images/logo.png" alt="Logo">
```

**Comment Ã§a marche ?**

+ `express.static` sert les fichiers **depuis le dossier `public/`**.
+ Les URLs dans le HTML **correspondent aux chemins relatifs** depuis `public/`.
  + `/css/style.css` â†’ `public/css/style.css`.
  + `/images/logo.png` â†’ `public/images/logo.png`.

---

### **ğŸ’¡ Bonnes Pratiques avec EJS et `express.static`**

1. **Organiser les fichiers** :
   + Placez les **templates** dans `views/`.
   + Placez les **fichiers statiques** (CSS, JS, images) dans `public/`.
2. **Utiliser des partiels** pour Ã©viter la rÃ©pÃ©tition (headers, footers, menus).
3. **Ã‰chapper les variables** avec `<%= %>` pour Ã©viter les **failles XSS**.
4. **Utiliser `path.join()`** pour construire les chemins de maniÃ¨re **cross-platform**.
5. **Minifier les fichiers statiques** en production (CSS, JS) pour amÃ©liorer les performances.

---

### **ğŸš€ Ce Que Jâ€™ai Appris Aujourdâ€™hui**

1. **EJS permet de crÃ©er des templates dynamiques** en mÃ©langeant HTML et JavaScript.
2. **Les partiels (`include`) Ã©vitent la rÃ©pÃ©tition** de code (DRY).
3. **`express.static` simplifie la gestion des fichiers statiques** (CSS, JS, images).
4. **La sÃ©paration des prÃ©occupations** (templates vs logique mÃ©tier) rend le code **plus maintenable**.
5. **Les chemins relatifs** dans les templates pointent vers le dossier `public/`.

---

## **âŒ¨ï¸ Challenge du jour**

Pas de challenge aujourd'hui. L'occasion pour moi de digÃ©rer tout Ã§a et de pratiquer en autonomie.
